import com.jxl.shuriken.core.UIComponent;import com.jxl.shuriken.controls.LinkButton;import com.jxl.shuriken.events.ShurikenEvent;import com.jxl.shuriken.events.Event;import com.jxl.shuriken.events.Callback;import com.jxl.shuriken.core.Collection;import com.jxl.shuriken.utils.DateUtils;import com.jxl.shuriken.utils.LoopUtils;import com.jxl.threesixtyflex.views.UpArrowButton;import com.jxl.threesixtyflex.views.DownArrowButton;import com.jxl.threesixtyflex.vo.EventVO;import com.jxl.threesixtyflex.views.Alertimport com.jxl.threesixtyflex.views.EventItem;class com.jxl.threesixtyflex.views.TodayView extends UIComponent{	public static var SYMBOL_NAME:String = "com.jxl.threesixtyflex.views.TodayView";		public static var EVENT_MAIN:String = "main";		private var __title_txt:TextField;	private var __top_pb:UpArrowButton;	private var __bottom_pb:DownArrowButton;	//private var __event_txt:TextField;	private var __main_lb:LinkButton;	private var __copy_txt:TextField;		private var __mainCallback:Callback;	private var __events:Collection;	private var __currentIndex:Number;	private var __display:Number = 3;	private var __drawIndex:Number;	private var __show:LoopUtils;		public function TodayView()	{	}		private function createChildren():Void	{		super.createChildren();				if(__title_txt == null)		{			__title_txt = createLabel("__title_txt");			__title_txt.autoSize = "left";			__title_txt.multiline = false;			__title_txt.wordWrap = false;			var titleTF:TextFormat = __title_txt.getTextFormat();			titleTF.size = 13;			titleTF.font = "Trebuchet MS";			titleTF.bold = true;			__title_txt.setNewTextFormat(titleTF);		}				if(__top_pb == null)		{			__top_pb = UpArrowButton(createComponent(UpArrowButton, "__top_pb"));			__top_pb.setReleaseCallback(this, onUp);		}				if(__bottom_pb == null)		{			__bottom_pb = DownArrowButton(createComponent(DownArrowButton, "__bottom_pb"));			__bottom_pb.setReleaseCallback(this, onDown);		}				/*if(__event_txt == null)		{			__event_txt = createLabel("__event_txt");			__event_txt.multiline = true;			__event_txt.wordWrap = true;			__event_txt.html = true;			//__event_txt.background = true;			//__event_txt.backgroundColor = 0xCCCCCC;			__event_txt.embedFonts = true;			var eventTF:TextFormat = __event_txt.getTextFormat();			eventTF.leading = 0;			//__event_txt.setTextFormat(eventTF);			__event_txt.setNewTextFormat(eventTF);		}*/				if(__main_lb == null)		{			__main_lb = LinkButton(createComponent(LinkButton, "__main_lb"));			__main_lb.setReleaseCallback(this, onMain);			var mTF:TextFormat = __main_lb.textField.getTextFormat();			mTF.bold = true;			__main_lb.textField.setNewTextFormat(mTF);			__main_lb.label = "Back to Main";		}				if(__copy_txt == null)		{			__copy_txt = createLabel("__copy_txt");			//var cTF:TextFormat = __copy_txt.getTextFormat();//			cTF.size = 8;//			cTF.font = "kroeger 0853";			__copy_txt.embedFonts = true;			__copy_txt.setNewTextFormat(_global.pixelTF);			__copy_txt.text = "created by jesse warden";		}				__drawIndex = -1;		callLater(this, drawEI);	}		private function drawEI():Void	{		if(__drawIndex + 1 < __display)		{			__drawIndex++;			if(this["ei" + __drawIndex] == null)			{				createComponent(EventItem, "ei" + __drawIndex);			}			callLater(this, drawEI);		}		else		{			delete __drawIndex;			callLater(this, updateButtonVis);			callLater(this, updateText);			invalidate();		}	}		private function redraw():Void	{		super.redraw();				__title_txt.move(0, 0);		__title_txt.setSize(__title_txt.textWidth + 4, 17);				__top_pb.move(__title_txt._x, __title_txt._y + __title_txt._height + 8);		__top_pb.setSize(__width, __top_pb.height);				__copy_txt.setSize(__copy_txt.textWidth + 4, __copy_txt.textHeight + 4);		__copy_txt.move(__title_txt._x, (__height - __copy_txt._height) - 22);				__main_lb.setSize(__main_lb.textField.textWidth + 4, __main_lb.textField.textHeight + 4);		__main_lb.move(__title_txt._x, __copy_txt._y - __main_lb.height);				__bottom_pb.move(0, __main_lb.y - __bottom_pb.height);		__bottom_pb.setSize(__width, __bottom_pb.height);				//__event_txt.move(__top_pb.x, __top_pb.y + __top_pb.height);		//__event_txt.setSize(__width, (__height - __event_txt._y) - (__height - __main_lb._y) - __bottom_pb.height);				var eX:Number = __top_pb.x;		var eY:Number = __top_pb.y + __top_pb.height;		//trace("------------");		//trace("TodayView::redraw");		for(var i:Number = 0; i<__display; i++)		{			var eventItem:EventItem = EventItem(this["ei" + i]);			eventItem.move(eX, eY);			//trace("eventItem.x: " + eventItem.x + ", eventItem.y: " + eventItem.y);			eventItem.setSize(__width, eventItem.height);			eY += eventItem.height + 5;		}	}		private function onUp(event:ShurikenEvent):Void	{		if(__currentIndex - __display >= 0)		{			__currentIndex -= __display;		}		else if(__currentIndex - 1 >= 0)		{			__currentIndex -= 1;		}				callLater(this, updateButtonVis);		callLater(this, updateText);	}		private function onDown(event:ShurikenEvent):Void	{		//trace("--------------------");		//trace("TodayView::onDown");		//trace("__currentIndex: " + __currentIndex);		//trace("__display: " + __display);		if(__currentIndex + __display < __events.getLength())		{			__currentIndex += __display;		}		else if(__currentIndex + 1 < __events.getLength())		{			__currentIndex += 1;		}				callLater(this, updateButtonVis);		callLater(this, updateText);	}		private function updateButtonVis():Void	{		//trace("__currentIndex - __display: " + (__currentIndex - __display));		if(__currentIndex - __display >= 0)		{			__top_pb._visible = true;		}		else		{			__top_pb._visible = false;			Selection.setFocus(__bottom_pb);		}				if(__currentIndex + __display < __events.getLength())		{			__bottom_pb._visible = true;		}		else		{			__bottom_pb._visible = false;			Selection.setFocus(__top_pb);		}	}		private function updateText():Void	{		if(__drawIndex != null) return;		if(__show != null) __show.destroy();		//__event_txt.htmlText = "";		__show = new LoopUtils(this);		__show.forLoop(0,					   __display,					   1,					   this,					   onShowNext,					   onShowDone);	}		private function onShowNext(index:Number):Void	{		//trace("-------------------");		//trace("TodayView::onShowNext, index: " + index);		var eventVO:EventVO = EventVO(__events.getItemAt(index + __currentIndex));		EventItem(this["ei" + index]).setEvent(eventVO);		/*if(eventVO == null) return;				var str:String = "";		str += "<font face='Verdana' size='11' color='#009900'><b>";		str += DateUtils.format(eventVO.startTime, DateUtils.HOUR_MIN_AM_PM);		str += " - ";		str += DateUtils.format(eventVO.endTime, DateUtils.HOUR_MIN_AM_PM);		str += "</b></font><br />";		str += "<font face='kroeger 0853' size='8' color='#000000'>";		str += "<b>" + eventVO.name + "</b></font><br />";		str += "<font face='kroeger 0855' size='8' color='#000000'>";		str += eventVO.speaker + "<br /><br /></font>";				__event_txt.htmlText += str;*/	}		private function onShowDone():Void	{		__show.destroy();		delete __show;	}		private function onMain(event:ShurikenEvent):Void	{		__mainCallback.dispatch(new Event(EVENT_MAIN, this));	}		// array with a bunch of EventVO's in it	public function setEvents(day:Number, events:Collection):Void	{		var theDay:String;		switch(day)		{			case 5:				theDay = "Monday";				break;							case 6:				theDay = "Tuesday";				break;							case 7:				theDay = "Wednesday";				break;		}		__title_txt.text = "360Flex - " + theDay;		invalidate();		__currentIndex = 0;		__events = events;		Selection.setFocus(__bottom_pb);		callLater(this, updateButtonVis);		callLater(this, updateText);	}		public function setMainCallback(scope:Object, func:Function):Void	{		__mainCallback = new Callback(scope, func);	}}